import os
import glob
import csv

desired_cols = [    # provide list of columns that you'd like to extract from the input files
        'WAVE'
        ,'DUMINTERVWID'
        ,'DUMENDDATE'
        ,'QB10GRID_1'
        ,'QB10GRID_2'
        ,'QB10GRID_3'
        ,'QB10GRID_4'
        ,'QB10GRID_5'
        ,'QB15_1'
        ,'QB15_2'
        ,'QB15_3'
        ,'QB15_4'
        ,'QB15_5'
        ,'QB30GRID_1_1'
        ,'QB30GRID_1_2'
        ,'QB30GRID_1_3'
        ,'QB30GRID_1_4'
        ,'QB30GRID_1_5'
        ,'QB30GRID_1_6'
        ,'QB30GRID_1_7'
        ,'QB30GRID_1_8'
        ,'QB30GRID_1_9'
        ,'QB30GRID_1_10'
        ,'QB30GRID_1_11'
        ,'QB30GRID_1_12'
        ,'QB30GRID_1_13'
        ,'QB30GRID_1_14'
        ,'QB30GRID_1_15'
        ,'QB30GRID_1_16'
        ,'QB30GRID_1_17'
        ,'QB30GRID_1_18'
        ,'QB30GRID_1_19'
        ,'QB30GRID_1_20'
        ,'QB30GRID_2_1'
        ,'QB30GRID_2_2'
        ,'QB30GRID_2_3'
        ,'QB30GRID_2_4'
        ,'QB30GRID_2_5'
        ,'QB30GRID_2_6'
        ,'QB30GRID_2_7'
        ,'QB30GRID_2_8'
        ,'QB30GRID_2_9'
        ,'QB30GRID_2_10'
        ,'QB30GRID_2_11'
        ,'QB30GRID_2_12'
        ,'QB30GRID_2_13'
        ,'QB30GRID_2_14'
        ,'QB30GRID_2_15'
        ,'QB30GRID_2_16'
        ,'QB30GRID_2_17'
        ,'QB30GRID_2_18'
        ,'QB30GRID_2_19'
        ,'QB30GRID_2_20'
        ,'QB30GRID_3_1'
        ,'QB30GRID_3_2'
        ,'QB30GRID_3_3'
        ,'QB30GRID_3_4'
        ,'QB30GRID_3_5'
        ,'QB30GRID_3_6'
        ,'QB30GRID_3_7'
        ,'QB30GRID_3_8'
        ,'QB30GRID_3_9'
        ,'QB30GRID_3_10'
        ,'QB30GRID_3_11'
        ,'QB30GRID_3_12'
        ,'QB30GRID_3_13'
        ,'QB30GRID_3_14'
        ,'QB30GRID_3_15'
        ,'QB30GRID_3_16'
        ,'QB30GRID_3_17'
        ,'QB30GRID_3_18'
        ,'QB30GRID_3_19'
        ,'QB30GRID_3_20'
        ,'QB30GRID_4_1'
        ,'QB30GRID_4_2'
        ,'QB30GRID_4_3'
        ,'QB30GRID_4_4'
        ,'QB30GRID_4_5'
        ,'QB30GRID_4_6'
        ,'QB30GRID_4_7'
        ,'QB30GRID_4_8'
        ,'QB30GRID_4_9'
        ,'QB30GRID_4_10'
        ,'QB30GRID_4_11'
        ,'QB30GRID_4_12'
        ,'QB30GRID_4_13'
        ,'QB30GRID_4_14'
        ,'QB30GRID_4_15'
        ,'QB30GRID_4_16'
        ,'QB30GRID_4_17'
        ,'QB30GRID_4_18'
        ,'QB30GRID_4_19'
        ,'QB30GRID_4_20'
        ,'QB30GRID_5_1'
        ,'QB30GRID_5_2'
        ,'QB30GRID_5_3'
        ,'QB30GRID_5_4'
        ,'QB30GRID_5_5'
        ,'QB30GRID_5_6'
        ,'QB30GRID_5_7'
        ,'QB30GRID_5_8'
        ,'QB30GRID_5_9'
        ,'QB30GRID_5_10'
        ,'QB30GRID_5_11'
        ,'QB30GRID_5_12'
        ,'QB30GRID_5_13'
        ,'QB30GRID_5_14'
        ,'QB30GRID_5_15'
        ,'QB30GRID_5_16'
        ,'QB30GRID_5_17'
        ,'QB30GRID_5_18'
        ,'QB30GRID_5_19'
        ,'QB30GRID_5_20'
        ,'QB40GRID_1_01'
        ,'QB40GRID_1_02'
        ,'QB40GRID_1_03'
        ,'QB40GRID_1_04'
        ,'QB40GRID_1_05'
        ,'QB40GRID_1_06'
        ,'QB40GRID_1_07'
        ,'QB40GRID_1_08'
        ,'QB40GRID_1_09'
        ,'QB40GRID_1_10'
        ,'QB40GRID_1_11'
        ,'QB40GRID_1_12'
        ,'QB40GRID_1_13'
        ,'QB40GRID_1_14'
        ,'QB40GRID_1_15'
        ,'QB40GRID_1_16'
        ,'QB40GRID_1_17'
        ,'QB40GRID_1_18'
        ,'QB40GRID_1_19'
        ,'QB40GRID_1_20'
        ,'QB40GRID_1_21'
        ,'QB40GRID_1_22'
        ,'QB40GRID_1_23'
        ,'QB40GRID_1_24'
        ,'QB40GRID_1_25'
        ,'QB40GRID_1_26'
        ,'QB40GRID_2_01'
        ,'QB40GRID_2_02'
        ,'QB40GRID_2_03'
        ,'QB40GRID_2_04'
        ,'QB40GRID_2_05'
        ,'QB40GRID_2_06'
        ,'QB40GRID_2_07'
        ,'QB40GRID_2_08'
        ,'QB40GRID_2_09'
        ,'QB40GRID_2_10'
        ,'QB40GRID_2_11'
        ,'QB40GRID_2_12'
        ,'QB40GRID_2_13'
        ,'QB40GRID_2_14'
        ,'QB40GRID_2_15'
        ,'QB40GRID_2_16'
        ,'QB40GRID_2_17'
        ,'QB40GRID_2_18'
        ,'QB40GRID_2_19'
        ,'QB40GRID_2_20'
        ,'QB40GRID_2_21'
        ,'QB40GRID_2_22'
        ,'QB40GRID_2_23'
        ,'QB40GRID_2_24'
        ,'QB40GRID_2_25'
        ,'QB40GRID_2_26'
        ,'QB40GRID_3_01'
        ,'QB40GRID_3_02'
        ,'QB40GRID_3_03'
        ,'QB40GRID_3_04'
        ,'QB40GRID_3_05'
        ,'QB40GRID_3_06'
        ,'QB40GRID_3_07'
        ,'QB40GRID_3_08'
        ,'QB40GRID_3_09'
        ,'QB40GRID_3_10'
        ,'QB40GRID_3_11'
        ,'QB40GRID_3_12'
        ,'QB40GRID_3_13'
        ,'QB40GRID_3_14'
        ,'QB40GRID_3_15'
        ,'QB40GRID_3_16'
        ,'QB40GRID_3_17'
        ,'QB40GRID_3_18'
        ,'QB40GRID_3_19'
        ,'QB40GRID_3_20'
        ,'QB40GRID_3_21'
        ,'QB40GRID_3_22'
        ,'QB40GRID_3_23'
        ,'QB40GRID_3_24'
        ,'QB40GRID_3_25'
        ,'QB40GRID_3_26'
        ,'QB40GRID_4_01'
        ,'QB40GRID_4_02'
        ,'QB40GRID_4_03'
        ,'QB40GRID_4_04'
        ,'QB40GRID_4_05'
        ,'QB40GRID_4_06'
        ,'QB40GRID_4_07'
        ,'QB40GRID_4_08'
        ,'QB40GRID_4_09'
        ,'QB40GRID_4_10'
        ,'QB40GRID_4_11'
        ,'QB40GRID_4_12'
        ,'QB40GRID_4_13'
        ,'QB40GRID_4_14'
        ,'QB40GRID_4_15'
        ,'QB40GRID_4_16'
        ,'QB40GRID_4_17'
        ,'QB40GRID_4_18'
        ,'QB40GRID_4_19'
        ,'QB40GRID_4_20'
        ,'QB40GRID_4_21'
        ,'QB40GRID_4_22'
        ,'QB40GRID_4_23'
        ,'QB40GRID_4_24'
        ,'QB40GRID_4_25'
        ,'QB40GRID_4_26'
        ,'QB40GRID_5_01'
        ,'QB40GRID_5_02'
        ,'QB40GRID_5_03'
        ,'QB40GRID_5_04'
        ,'QB40GRID_5_05'
        ,'QB40GRID_5_06'
        ,'QB40GRID_5_07'
        ,'QB40GRID_5_08'
        ,'QB40GRID_5_09'
        ,'QB40GRID_5_10'
        ,'QB40GRID_5_11'
        ,'QB40GRID_5_12'
        ,'QB40GRID_5_13'
        ,'QB40GRID_5_14'
        ,'QB40GRID_5_15'
        ,'QB40GRID_5_16'
        ,'QB40GRID_5_17'
        ,'QB40GRID_5_18'
        ,'QB40GRID_5_19'
        ,'QB40GRID_5_20'
        ,'QB40GRID_5_21'
        ,'QB40GRID_5_22'
        ,'QB40GRID_5_23'
        ,'QB40GRID_5_24'
        ,'QB40GRID_5_25'
        ,'QB40GRID_5_26'
        ,'OQP30_TOTAL_FINAL_1'
        ,'OQP30_TOTAL_FINAL_2'
        ,'OQP30_TOTAL_FINAL_7'
        ,'OQP30_TOTAL_FINAL_8'
        ,'OQP30_TOTAL_FINAL_16'
        ,'QP10_QP20_FINAL_1'
        ,'QP10_QP20_FINAL_2'
        ,'QP10_QP20_FINAL_7'
        ,'QP10_QP20_FINAL_8'
        ,'QP10_QP20_FINAL_16'
        ,'WEEK_FINAL'
]

input_folder_name = 'BrandHealth' # make sure this folder is in the same folder as this Python script
output_folder_name = input_folder_name + '_Extracted'
input_folder_path = os.path.dirname(os.path.realpath(__file__))
input_folder = os.path.join(input_folder_path, input_folder_name)
#input_files = [f for f in os.listdir(input_folder) if os.path.isfile(os.path.join(input_folder, f))]
input_files = glob.glob(input_folder + '/*')

output_folder = os.path.join(input_folder_path, output_folder_name)
if not os.path.exists(output_folder):
    os.makedirs(output_folder)

for f in input_files:
    output_data = [desired_cols]
    output_file_name = os.path.splitext(os.path.basename(f))[0] + '_Extracted.csv'
    output_file = os.path.join(output_folder, output_file_name)

    with open(f, 'r') as incsv:
        csvreader = csv.reader(incsv)
        row_cnt = 0
        for row in csvreader:
            output_row = []
            row_cnt += 1
            if row_cnt == 1:
                col_idx = {x:i for i,x in enumerate(row)}
            else:
                for c in desired_cols:
                    if c in col_idx:
                        try:
                            output_row.append(row[col_idx[c]])
                        except IndexError as e:
                            print(f)
                            print(row)
                            print(row_cnt, ': ', col_idx[c])
                    else:
                        output_row.append('')
                output_data.append(output_row)

        with open(output_file, 'w',  newline='') as outcsv:
            csvwriter = csv.writer(outcsv)
            csvwriter.writerows(output_data)

print('ha')